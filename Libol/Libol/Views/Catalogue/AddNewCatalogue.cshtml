@using Libol.Models;
@using Libol.EntityResult;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    #textColorInput {
        color: red;
    }

    label {
        text-align: right;
    }
</style>
<h4 style="margin:1rem">Danh sách biên mục</h4>
<form action="~/Catalogue/AddNewCatalogue" method="post">
    @{
        List<FPT_SP_CATA_GET_MARC_FORM_Result> list = ViewData["ListMarcForm"] as List<FPT_SP_CATA_GET_MARC_FORM_Result>;
        List<CAT_DIC_DIRLEVEL> listLevelDir = ViewData["listLevelDir"] as List<CAT_DIC_DIRLEVEL>; //cap thuw muc
        List<CAT_DIC_RECORDTYPE> ListRecordType = ViewData["ListRecordType"] as List<CAT_DIC_RECORDTYPE>; //Kieu ban ghi
        List<CAT_DIC_ITEM_TYPE> listItemType = ViewData["listItemType"] as List<CAT_DIC_ITEM_TYPE>; //dang tai lieu
        List<CAT_DIC_MEDIUM> listMedium = ViewData["listMedium"] as List<CAT_DIC_MEDIUM>; // vat mang tin
        byte[] listAccessLevel = ViewData["listAccessLevel"] as byte[]; // muc do mat
    }


    <div class="form-group row col-12">
        <label class="control-label col-md-3 align-self-center">Cấp thư mục : </label>
        <select class="form-control col-md-2" name="dirCode" id="levelDir">
            @{
                foreach (CAT_DIC_DIRLEVEL levelDir in listLevelDir)
                {
                    <option value="@levelDir.Code">@levelDir.Description</option>
                }
            }
        </select>
    </div>

    <div class="form-group row col-12">
        <label class="control-label col-md-3 align-self-center">Kiểu bản ghi : </label>
        <select class="form-control col-md-2" name="recordTypeCode" id="recordTypeCode">
            @{
                foreach (CAT_DIC_RECORDTYPE recordType in ListRecordType)
                {
                    <option value="@recordType.Code">@recordType.Description</option>
                }
            }
        </select>
        <label class="control-label col-md-2 align-self-center">Vật mang tin : </label>
        <select class="form-control col-md-2" name="mediumId" id="mediumId">
            @{
                foreach (CAT_DIC_MEDIUM medium in listMedium)
                {
                    <option value="@medium.ID">@medium.Description</option>
                }
            }
        </select>
    </div>
    <div class="form-group row col-12">
        <label class="control-label col-md-3 align-self-center">Dạng tài liệu : </label>
        <select class="form-control col-md-2" name="itemTypeId" id="itemTypeId">
            @{
                foreach (CAT_DIC_ITEM_TYPE itemType in listItemType)
                {
                    <option value="@itemType.ID">@itemType.TypeName</option>
                }
            }
        </select>
        <label class="control-label col-md-2 align-self-center">Mức độ : </label>
        <select class="form-control col-md-2" name="accessLevel" id="accessLevel">
            @{
                foreach (byte number in listAccessLevel)
                {
                    <option value="@number">@number</option>
                }
            }
        </select>
    </div>
    <div class="form-group row col-12">

        <label class="control-label col-md-3 align-self-center">Chọn Mẫu Biên Mục </label>


        <select class="form-control col-md-2" name="formId" id="listMarcFormID" onchange="SelectedForm();">
            @foreach (FPT_SP_CATA_GET_MARC_FORM_Result item in list)
            {
                <option value="@item.ID">@item.Name</option>
            }
        </select>
    </div>
    <script>

        function SelectedForm() {

            var empObj = {
                intIsAuthority: 0,
                intFormID: $("#listMarcFormID :selected").val()
            };
            var html = "";
            $.ajax({
                url: "/Catalogue/LoadFormComplated",
                type: "POST",
                data: JSON.stringify(empObj),
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    doWork(result);
                    $.each(result, function (i, item) {
                        var field = item.FieldCode;
                        field = field.replace('$', '');

                        html += "<div class='form-group row col-12' id ='dv" + field + "'><label class='control-label col-md-5 align-self-center font-weight-bold'  id ='lb" + field + "' > " + item.VietFieldName + " [" + item.FieldCode + "]" + "</label><input type='text' class='form-control col-md-2' id=" + field + "></input> </div>";
                    });
                    $("#test").html(html);
                    document.getElementById("lb245a").style.color = "red";
                    document.getElementById("btnCreate").disabled = false;
                    document.getElementById("btnReset").disabled = false;
                    document.getElementById("btnAddField").disabled = false;
                },
                error: function (errorThrown) {
                    alert(errorThrown);
                }

            });

        }

    </script>
    <script>
        function doWork(data) {
            $.each(data, function (i, item) {
                console.log(item.FieldCode);


            });
        }

        function AddNewItem() {
            var empObj = {
                formId: $("#listMarcFormID :selected").val(),
                dirCode: $("#levelDir :selected").val(),
                mediumId: $("#mediumId :selected").val(),
                recordTypeCode: $("#recordTypeCode :selected").val() ,
                itemTypeId: $("#itemTypeId :selected").val(),
                accessLevel: $("#accessLevel :selected").val()
            };

            $.ajax({
                url: "/Catalogue/AddNewItem",
                type: "POST",
                data: JSON.stringify(empObj),
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (code) {

                    alert("Bạn Đã Tạo Thành Công Biên Mục : " + code );
                    
                },
                error: function (errorThrown) {
                    alert(errorThrown);
                }

            });
        }
    </script>


    <div id="test">

    </div>



    <div class="form-group col-md-12 form-inline">
        <div class="form-row col-md-12 text-center">
            <div style="margin : auto">
                <input disabled type="button" id="btnCreate" class="btn btn-primary form-control" value="Tạo mới" onclick="AddNewItem();" />
                <button disabled type="button" id="btnReset" class="btn btn-primary form-control">Đặt Lại</button>
                <button disabled type="button" id="btnAddField" class="btn btn-primary form-control" data-toggle="modal" data-target="#myModal">Thêm Trường</button>
            </div>
        </div>
    </div>
</form>

<!-- The Modal -->
<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title">Tìm Kiếm Theo Mã Trường Hoặc Tên Trường </h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div class="container mt-1">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control">
                        <div class="input-group-append">
                            <button class="btn btn-success" type="submit">Tìm Kiếm</button>
                        </div>
                    </div>
                    <textarea class="form-control rounded-0" rows="10"></textarea>
                </div>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Đóng</button>
            </div>

        </div>
    </div>
</div>

@*<div class="form-group row col-12">
        <label class="control-label col-md-3 align-self-center">ISBN[020$a] : </label>
        <input type="text" class="form-control col-md-2" id="inputEmail3">
        <label class="control-label col-md-2 align-self-center">ISSN[022$a] : </label>
        <input type="text" class="form-control col-md-2" id="inputEmail3">
    </div>*@