
@{
    ViewBag.Title = "ReportLoanCopy";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <link rel="stylesheet" type="text/css" href="~/Content/bootstrap.css">
        <title>Thống kê ấn phẩm đã được mượn</title>
    </head>
<body>
    <h4 style="margin-top:20px;background-color:Highlight; color: white;">Thống kê ấn phẩm đã được mượn</h4>
    <div class="table-responsive">
        <table id="demo" class="table">
            <thead>
                <tr></tr>
            </thead>
            <tbody>
                <tr>
                    <td class="text-right">Thư viện</td>
                    <td>@Html.DropDownList("Library", ViewData["lib"] as List<SelectListItem>)</td>
                    <td class="text-right">Số thẻ</td>
                    <td><input id="PatronNumber" name="PatronNumber" type="text" /></td>
                    <td class="text-right">Mượn từ ngày</td>
                    <td><input id="CheckOutDateFrom" name="CheckOutDateFrom" type="date" /></td>
                    <td class="text-right">Tới</td>
                    <td><input id="CheckOutDateTo" name="CheckOutDateTo" type="date" /></td>
                </tr>
                <tr>
                    <td class="text-right">Kho</td>
                    <td>@Html.DropDownList("LocationPrefix", new SelectList(string.Empty, "Value", "Text"), "Chọn Kho")</td>
                    <td class="text-right">Mã tài liệu</td>
                    <td><input id="ItemCode" name="ItemCode" type="text" /></td>
                    <td class="text-right">Trả từ ngày</td>
                    <td><input id="CheckInDateFrom" name="CheckInDateFrom" type="date" /></td>
                    <td class="text-right">Tới</td>
                    <td><input id="CheckInDateTo" name="CheckInDateTo" type="date" /></td>
                </tr>
                <tr>
                    <td class="text-right">Lĩnh vực kho</td>
                    <td>@Html.DropDownList("LocationsByPrefix", new SelectList(string.Empty, "Value", "Text"), "Chọn lĩnh vực")</td>
                    <td class="text-right">Đăng ký cá biệt</td>
                    <td><input id="CopyNumber" name="CopyNumber" type="text" /></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div>
        <label style="color:red;">
            <input id="Filter" name="Filter" type="checkbox" />
            Lọc dữ liệu đã được gia hạn
        </label>
    </div>
    <div class="btn-group d-xl-flex justify-content-xl-center" role="group">
        <button id="find" type="submit" style="margin-right:20px;">Tìm</button>
        <button id="reset" type="button" onclick="reset()">Đặt lại</button>
    </div>
    <div id="ContentStatLoan"></div>
</body>

<script type="text/javascript">
    $(document).ready(function () {
        $("#Library").change(function () {
            $("#LocationPrefix").empty();
            $("#LocationsByPrefix").empty();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetLocationsPrefix")', // we are calling json method
                dataType: 'json',
                data: { id: $("#Library").val() },
                success: function (locs) {
                    $.each(locs, function (i, loc) {
                        $("#LocationPrefix").append('<option value="' + loc.Value + '">' +
                            loc.Text + '</option>');
                    });
                }
            });
            return false;
        });
        $("#LocationPrefix").change(function () {
            $("#LocationsByPrefix").empty();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetLocationsByPrefix")', // we are calling json method
                dataType: 'json',
                data: { id: $("#Library").val(), prefix: $("#LocationPrefix").val() },
                success: function (locs) {
                    $.each(locs, function (i, loc) {
                        $("#LocationsByPrefix").append('<option value="' + loc.Value + '">' +
                            loc.Text + '</option>');
                    });
                }
            });
            return false;
        });
    });
    document.getElementById("find").onclick = function () {
        var empObj = {
            strLibID: document.getElementById("Library").value,
            strLocPrefix: document.getElementById("LocationPrefix").value,
            strLocID: document.getElementById("LocationsByPrefix").value,
            strPatronNumber: document.getElementById("PatronNumber").value,
            strItemCode: document.getElementById("ItemCode").value,
            strCopyNumber: document.getElementById("CopyNumber").value,
            strCheckInDateFrom: document.getElementById("CheckInDateFrom").value,
            strCheckInDateTo: document.getElementById("CheckInDateTo").value,
            strCheckOutDateFrom: document.getElementById("CheckOutDateFrom").value,
            strCheckOutDateTo: document.getElementById("CheckOutDateTo").value,
        };
        if (document.getElementById("Filter").checked) {
            $.ajax({
                url: "GetFilteredLoanStats",
                data: JSON.stringify(empObj),
                contentType: "application/json;charset=utf-8",
                type: "POST",
                beforeSend: function() {
                    $("#ContentStatLoan").html("<h4>Loading...</h4>");
                },
                success: function (result) {
                    $("#ContentStatLoan").html(result)
                },
                error: function (errormessage) {
                    console.log("error");
                }
            });
        }
        else {
            $.ajax({
                url: "GetLoanStats",
                data: JSON.stringify(empObj),
                contentType: "application/json;charset=utf-8",
                type: "POST",
                beforeSend: function() {
                    $("#ContentStatLoan").html("<h4>Loading...</h4>");
                },
                success: function (result) {
                    $("#ContentStatLoan").html(result)
                },
                error: function (errormessage) {
                    console.log("error");
                }
            });
        }

    };
</script>
<script>
    $(window).bind("pageshow", function () {
        $("#Library").val('');
        $("#Location").val('');
    });
    function reset() {
        $("#Library").val('');
        $("#Location").empty();
        $("#CopyNumber").val('');
        $("#ItemCode").val('');
        $("#PatronNumber").val('');
        $("#CheckOutDateFrom").val('');
        $("#CheckOutDateTo").val('');
        $("#CheckInDateFrom").val('');
        $("#CheckInDateTo").val('');
    }
</script>