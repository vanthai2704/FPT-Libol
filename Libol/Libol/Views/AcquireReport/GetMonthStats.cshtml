<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
</head>
<script>
    function exportTableToExcel(tableID1, tableID2, tableID3, filename = '') {
        var downloadLink;
        var dataType = 'application/vnd.ms-excel';
        var tableSelect1 = document.getElementById(tableID1);
        var tableSelect2 = document.getElementById(tableID2);
        var tableSelect3 = document.getElementById(tableID3);
        var tableHTML1 = tableSelect1.outerHTML.replace(/ /g, '%20');
        var tableHTML2 = tableSelect2.outerHTML.replace(/ /g, '%20');
        var tableHTML3 = tableSelect3.outerHTML.replace(/ /g, '%20');
        var tableHTML = tableHTML1 + "<br/>" + tableHTML2 + "<br/>" + tableHTML3;
        // Specify file name
        filename = filename ? filename + '.xls' : 'excel_data.xls';

        // Create download link element
        downloadLink = document.createElement("a");

        document.body.appendChild(downloadLink);

        if (navigator.msSaveOrOpenBlob) {
            var blob = new Blob(['\ufeff', tableHTML], {
                type: dataType
            });
            navigator.msSaveOrOpenBlob(blob, filename);
        } else {
            // Create a link to the file
            downloadLink.href = 'data:' + dataType + ', ' + tableHTML;

            // Setting the file name
            downloadLink.download = filename;

            //triggering the function
            downloadLink.click();
        }
    }
</script>
@{
    int sum1 = 0;
    int sum2 = 0;
    double sum3 = 0;
}
@if (ViewBag.Result.Count < 1)
{
    <h5 class="text-center">Không có dữ liệu</h5>
}
else
{
    <div id="Main">
        <table align="center">
            <tr valign="top">
                <td style="width: 35%;">
                    <div id="table_div1" style="margin-top: 150px;">
                        <h4 id="stat1" style="margin-left:50px;">Số đầu ấn phẩm</h4><br />
                        <table id="table1" class="WordSection1 table-striped table-bordered" style="margin-left:50px; border: thin;" border="1">
                            <tr>
                                <th>Tháng</th>
                                <th>Số đầu ấn phẩm</th>
                            </tr>
                            @foreach (var item in ViewBag.Result)
                            {
                                <tr>
                                    <td>@item.Month</td>
                                    <td>@item.BooksTotal</td>
                                </tr>
                                sum1 += item.BooksTotal;
                            }
                        </table>
                    </div>
                </td>
                <td style="width: 65%;">
                    <div id="columnchart_values1" style="width: 900px; height: 700px;"></div>
                </td>
            </tr>
        </table>
        <table align="center">
            <tr valign="top">
                <td style="width: 35%;">
                    <div id="table_div2" style="margin-top: 150px;">
                        <h4 id="stat2" style="margin-left:50px;">Số bản ấn phẩm</h4><br />
                        <table id="table2" class="WordSection1 table-striped table-bordered" style="margin-left:50px; border: thin;" border="1">
                            <tr>
                                <th>Tháng</th>
                                <th>Số bản ấn phẩm</th>
                            </tr>
                            @foreach (var item in ViewBag.Result)
                            {
                                <tr>
                                    <td>@item.Month</td>
                                    <td>@item.CopiesTotal</td>
                                </tr>
                                sum2 += item.CopiesTotal;
                            }
                        </table>
                    </div>
                </td>
                <td style="width: 65%;">
                    <div id="columnchart_values2" style="width: 900px; height: 700px;"></div>
                </td>
            </tr>
        </table>
        <table align="center">
            <tr valign="top">
                <td style="width: 35%;">
                    <div id="table_div3" style="margin-top: 150px;">
                        <h4 id="stat3" style="margin-left:50px;">Số chi phí</h4><br />
                        <table id="table3" class="WordSection1 table-striped table-bordered" style="margin-left:50px; border: thin;" border="1">
                            <tr>
                                <th>Tháng</th>
                                <th>Số chi phí</th>
                            </tr>
                            @foreach (var item in ViewBag.Result)
                            {
                                <tr>
                                    <td>@item.Month</td>
                                    <td>@item.MoneyTotal</td>
                                </tr>
                                sum3 += item.MoneyTotal;
                            }
                        </table>
                    </div>
                </td>
                <td style="width: 65%;">
                    <div id="columnchart_values3" style="width: 900px; height: 700px;"></div>
                </td>
            </tr>
        </table>
    </div>
    <hr />
    <div class="btn-group d-xl-flex justify-content-xl-center" role="group">
        <button id="print" type="button" style="margin-right:20px;">In</button>
        <button id="excel" type="button" style="margin-right:20px;" onclick="exportTableToExcel('table1','table2','table3', 'ThongKeHangNam')">Lưu vào file excel</button>
    </div>
}
<script type="text/javascript">

    google.charts.load("current", { packages: ['corechart'] });
    @if (ViewBag.Result.Count >= 1)
    {
        <text>
    google.charts.setOnLoadCallback(drawChart1);
    google.charts.setOnLoadCallback(drawChart2);
    google.charts.setOnLoadCallback(drawChart3);
    document.getElementById("stat1").innerHTML = "Số đầu ấn phẩm: " + @sum1;
    document.getElementById("stat2").innerHTML = "Số bản ấn phẩm: " + @sum2;
    document.getElementById("stat3").innerHTML = "Số chi phí: " + @sum3;
        </text>
    }


    function drawChart1() {
        var table = document.getElementById("table1");
        if (table.rows.length <= 1)
            return;
        var len = table.rows.length;
        var arr = [["Tháng", "Số đầu ấn phẩm", { role: "style" }]];
        for (var i = 1; i < len; i++) {
            arr.push([table.rows[i].cells[0].innerHTML, parseInt(table.rows[i].cells[1].innerHTML), "aquamarine1"]);
        }
        var data = google.visualization.arrayToDataTable(arr);

        var view = new google.visualization.DataView(data);
        view.setColumns([0, 1,
            {
                calc: "stringify",
                sourceColumn: 1,
                type: "string",
                role: "annotation"
            },
            2]);

        var options = {
            title: "",
            bar: { groupWidth: "50%" },
            legend: { position: "none" },
            hAxis: {
                title: 'Tháng',
            },
            vAxis: {
                title: 'Số lượng bổ sung',
            }

        };
        var chart = new google.visualization.ColumnChart(document.getElementById("columnchart_values1"));
        chart.draw(view, options);
    }

    function drawChart2() {
        var table = document.getElementById("table2");
        if (table.rows.length <= 1)
            return;
        var len = table.rows.length;
        var arr = [["Tháng", "Số bản ấn phẩm", { role: "style" }]];
        for (var i = 1; i < len; i++) {
            arr.push([table.rows[i].cells[0].innerHTML, parseInt(table.rows[i].cells[1].innerHTML), "aquamarine1"]);
        }
        var data = google.visualization.arrayToDataTable(arr);

        var view = new google.visualization.DataView(data);
        view.setColumns([0, 1,
            {
                calc: "stringify",
                sourceColumn: 1,
                type: "string",
                role: "annotation"
            },
            2]);

        var options = {
            title: "",
            bar: { groupWidth: "50%" },
            legend: { position: "none" },
            hAxis: {
                title: 'Tháng',
            },
            vAxis: {
                title: 'Số lượng bổ sung',
            }

        };
        var chart = new google.visualization.ColumnChart(document.getElementById("columnchart_values2"));
        chart.draw(view, options);
    }

    function drawChart3() {
        var table = document.getElementById("table3");
        if (table.rows.length <= 1)
            return;
        var len = table.rows.length;
        var arr = [["Tháng", "Số chi phí", { role: "style" }]];
        for (var i = 1; i < len; i++) {
            arr.push([table.rows[i].cells[0].innerHTML, parseInt(table.rows[i].cells[1].innerHTML), "aquamarine1"]);
        }
        var data = google.visualization.arrayToDataTable(arr);

        var view = new google.visualization.DataView(data);
        view.setColumns([0, 1,
            {
                calc: "stringify",
                sourceColumn: 1,
                type: "string",
                role: "annotation"
            },
            2]);

        var options = {
            title: "",
            bar: { groupWidth: "50%" },
            legend: { position: "none" },
            hAxis: {
                title: 'Tháng',
            },
            vAxis: {
                title: 'Số chi phí',
            }

        };
        var chart = new google.visualization.ColumnChart(document.getElementById("columnchart_values3"));
        chart.draw(view, options);
    }


</script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#print").click(function () {
            var divToPrint = document.getElementById("Main");
            newWin = window.open("");
            newWin.document.write(divToPrint.outerHTML);
            newWin.print();
            newWin.close();
        });
    });
</script>

